<div class="cart-page">
  <div class="container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb my-2 bg-white">
        <li class="breadcrumb-item"><a href="/" class="text-decoration-none">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Cart</li>
      </ol>
    </nav>
  </div>

  <ng-template #emptyCart>
    <div class="container mb-3">
      <div class="d-flex bg-light justify-content-center align-items-center" style="height: 300px;">
        <h3>Cart is empty</h3>
      </div>
    </div>
  </ng-template>

  <div class="container mb-3" *ngIf="cartForm.controls['products']['controls'].length; else emptyCart">
    <form [formGroup]="cartForm">
      <div formArrayName="products">
        <div
          class="d-flex flex-row w-100 py-3 border-bottom form-group"
          *ngFor="let product of cartForm.controls['products']['controls']; let i = index"
        >
          <div class="d-flex align-items-center pr-3">
            <i
              class="icon material-icons-outlined cursor-pointer text-secondary"
              (click)="removeProduct(product.value.uid, i)"
              >close</i
            >
          </div>
          <div class="d-flex align-items-center pr-4">
            <img
              #img
              [src]="product.imageUrl"
              style="height: 60px;"
              (error)="img.src = 'https://placeholder.pics/svg/300/f8f9fa/000000-f8f9fa/' + product.value.title"
            />
          </div>

          <div class="d-flex align-items-center flex-grow-1">
            <a [routerLink]="'/product/' + product.value.slug" class="text-decoration-none"
              >{{ product.value.title }}
            </a>
          </div>

          <div class="cart-page__info">
            <ng-container *ngIf="!product.value.duration">
              <div class="cart-page__info-price">
                {{ getPriceForSale(product.value.price, product.value.count) | currency }}
              </div>
              x
              <mat-form-field *ngIf="!product.value.duration" class="cart-page__info-input">
                <input matInput type="number" [formControl]="product.controls.count" [min]="1" />
              </mat-form-field>
            </ng-container>

            <ng-container *ngIf="product.value.duration">
              <div class="cart-page__info-price">
                {{ getPriceForRent(product.value.rentRates, product.value.duration) | currency }}
              </div>
              for
              <mat-form-field class="cart-page__info-input">
                <input matInput type="number" [formControl]="product.controls.duration" [min]="1" />
              </mat-form-field>
              <div class="cart-page__info-duration-placeholder">days</div>
            </ng-container>
          </div>
        </div>

        <div class="d-flex">
          <div class="p-3 w-100 text-right font-weight-500">Total: {{ totalPrice | currency }}</div>
        </div>

        <div class="cart-page__action">
          <a mat-raised-button color="primary" routerLink="/checkout">Proceed to checkout</a>
        </div>
      </div>
    </form>
  </div>
</div>
